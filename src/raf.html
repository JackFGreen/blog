<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RAF</title>
    <style>
      .test {
        width: 100px;
        height: 100px;
        background: green;
      }
    </style>
  </head>
  <body>
    <button>test</button>
    <div class="test"></div>

    <script>
      document.querySelector('button').addEventListener('click', () => {
        const test = document.querySelector('.test')
        test.style.transform = 'translate(400px, 0)'

        // 阻塞后上面代码有效
        alert()

        requestAnimationFrame(() => {
          test.style.transition = 'transform 3s linear'
          test.style.transform = 'translate(200px, 0)'

          test.style.background = 'blue'

          // alert()

          requestAnimationFrame(() => {
            alert()
            test.style.background = 'red'
          })
        })
      })
    </script>

    <!-- <script>
      let start = Date.now()
      function fn() {
        const now = Date.now()
        const diff = now - start
        start = now
        console.log(diff)
        // requestAnimationFrame(fn)
      }
      requestAnimationFrame(fn)
    </script> -->

    <!-- <script>
      var then = Date.now()
      var count = 0

      function nextFrame() {
        requestAnimationFrame(function () {
          count++
          if (count % 20 === 0) {
            var time = (Date.now() - then) / count
            var ms = Math.round(time * 1000) / 1000
            var fps = Math.round(100000 / ms) / 100
            console.log(`count: ${count}\t${ms}ms/frame\t${fps}fps`)
          }
          nextFrame()
        })
      }
      nextFrame()
    </script> -->
  </body>
</html>
